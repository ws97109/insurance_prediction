---
name: React 前端開發
status: open
created: 2025-10-09T02:52:41Z
updated: 2025-10-09T02:52:41Z
github: [Will be updated when synced to GitHub]
depends_on: [003]
parallel: true
conflicts_with: []
---

# Task: React 前端開發

## Description

使用 React + Chart.js 建構響應式前端應用，提供三個核心頁面：客戶分群儀表板、客戶推薦頁面、模型管理介面。整合 FastAPI 後端 API，實現即時查詢、視覺化圖表、資料匯出等功能。

**核心頁面**:
1. **Dashboard** - 客戶價值分群儀表板
2. **Recommendation** - 客戶推薦查詢頁面
3. **ModelManagement** - 模型效能監控

## Acceptance Criteria

### 通用需求
- [ ] React 專案架構建立完成 (Create React App 或 Vite)
- [ ] UI 框架整合 (Material-UI 或 Ant Design)
- [ ] API 串接層實作 (axios / fetch)
- [ ] 狀態管理 (React Context API)
- [ ] 響應式設計 (RWD) 支援手機/平板/桌機
- [ ] 路由管理 (React Router)
- [ ] JWT 認證整合 (登入頁面)

### Dashboard 頁面
- [ ] 圓餅圖顯示客戶價值分群占比 (高/中/低)
- [ ] 柱狀圖顯示各群組統計 (平均保險數、年齡分布等)
- [ ] 篩選器元件 (按區域、年齡、產品類型)
- [ ] 客戶清單表格 (可排序、分頁)
- [ ] 匯出 CSV 功能

### Recommendation 頁面
- [ ] 客戶 ID 搜尋框 (debounce 300ms)
- [ ] 客戶資訊卡片 (顯示基本資料、現有保險)
- [ ] Top 3 推薦產品卡片 (產品名稱、購買機率、推薦理由)
- [ ] 批量預測功能 (CSV 上傳)
- [ ] 批量預測結果下載
- [ ] 載入中狀態 (Loading Spinner)

### ModelManagement 頁面
- [ ] 模型效能指標卡片 (準確率、精確率、召回率)
- [ ] 準確率趨勢圖 (折線圖)
- [ ] 預測量統計 (每日/每週)
- [ ] 訓練資料上傳表單 (選用功能)

### 效能與體驗
- [ ] 頁面載入時間 < 2 秒
- [ ] 圖表渲染流暢 (60 FPS)
- [ ] 錯誤處理與使用者友善提示
- [ ] 繁體中文介面

## Technical Details

### 專案結構
```
frontend/
├── public/
├── src/
│   ├── components/
│   │   ├── common/
│   │   │   ├── Navbar.jsx
│   │   │   ├── Loading.jsx
│   │   │   ├── ErrorMessage.jsx
│   │   ├── dashboard/
│   │   │   ├── PieChart.jsx
│   │   │   ├── BarChart.jsx
│   │   │   ├── FilterPanel.jsx
│   │   │   ├── CustomerTable.jsx
│   │   ├── recommendation/
│   │   │   ├── SearchBox.jsx
│   │   │   ├── CustomerCard.jsx
│   │   │   ├── RecommendationCard.jsx
│   │   │   ├── BatchUpload.jsx
│   │   ├── model/
│   │   │   ├── MetricsCard.jsx
│   │   │   ├── TrendChart.jsx
│   ├── pages/
│   │   ├── Dashboard.jsx
│   │   ├── Recommendation.jsx
│   │   ├── ModelManagement.jsx
│   │   ├── Login.jsx
│   ├── services/
│   │   ├── api.js              # Axios 配置
│   │   ├── prediction.js       # 預測 API
│   │   ├── segment.js          # 分群 API
│   │   ├── auth.js             # 認證 API
│   ├── context/
│   │   ├── AuthContext.jsx
│   │   ├── DataContext.jsx
│   ├── utils/
│   │   ├── formatters.js       # 資料格式化
│   │   ├── exportCSV.js        # CSV 匯出
│   ├── App.jsx
│   ├── index.jsx
├── package.json
├── Dockerfile
└── .env
```

### 關鍵實作

#### 1. API 串接層
```javascript
// src/services/api.js
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 請求攔截器 (加入 JWT Token)
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export default api;
```

```javascript
// src/services/prediction.js
import api from './api';

export const predictSingle = async (customerId, features) => {
  const response = await api.post('/api/v1/predict/single', {
    customer_id: customerId,
    features: features,
  });
  return response.data;
};

export const predictBatch = async (file) => {
  const formData = new FormData();
  formData.append('file', file);

  const response = await api.post('/api/v1/predict/batch', formData, {
    headers: { 'Content-Type': 'multipart/form-data' },
  });
  return response.data;
};
```

#### 2. Dashboard 頁面 (Chart.js)
```javascript
// src/components/dashboard/PieChart.jsx
import { Pie } from 'react-chartjs-2';
import { Chart as ChartJS, ArcElement, Tooltip, Legend } from 'chart.js';

ChartJS.register(ArcElement, Tooltip, Legend);

function PieChart({ data }) {
  const chartData = {
    labels: ['高價值', '中價值', '低價值'],
    datasets: [{
      data: [data.high, data.medium, data.low],
      backgroundColor: ['#4caf50', '#ff9800', '#f44336'],
    }],
  };

  return <Pie data={chartData} />;
}
```

#### 3. Recommendation 頁面 (Debounce 搜尋)
```javascript
// src/pages/Recommendation.jsx
import { useState, useEffect } from 'react';
import { predictSingle } from '../services/prediction';
import debounce from 'lodash/debounce';

function Recommendation() {
  const [customerId, setCustomerId] = useState('');
  const [recommendations, setRecommendations] = useState(null);
  const [loading, setLoading] = useState(false);

  // Debounce 搜尋 (300ms)
  const debouncedSearch = debounce(async (id) => {
    if (!id) return;

    setLoading(true);
    try {
      const result = await predictSingle(id, features);
      setRecommendations(result.recommendations);
    } catch (error) {
      console.error('預測失敗:', error);
    } finally {
      setLoading(false);
    }
  }, 300);

  useEffect(() => {
    debouncedSearch(customerId);
  }, [customerId]);

  return (
    <div>
      <input
        type="text"
        placeholder="輸入客戶 ID"
        value={customerId}
        onChange={(e) => setCustomerId(e.target.value)}
      />
      {loading && <p>載入中...</p>}
      {recommendations && (
        <div>
          {recommendations.map((rec) => (
            <RecommendationCard key={rec.product_id} recommendation={rec} />
          ))}
        </div>
      )}
    </div>
  );
}
```

#### 4. 狀態管理 (Context API)
```javascript
// src/context/AuthContext.jsx
import { createContext, useState, useContext } from 'react';

const AuthContext = createContext();

export function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(localStorage.getItem('token'));

  const login = (userData, authToken) => {
    setUser(userData);
    setToken(authToken);
    localStorage.setItem('token', authToken);
  };

  const logout = () => {
    setUser(null);
    setToken(null);
    localStorage.removeItem('token');
  };

  return (
    <AuthContext.Provider value={{ user, token, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}

export const useAuth = () => useContext(AuthContext);
```

#### 5. CSV 匯出功能
```javascript
// src/utils/exportCSV.js
export const exportToCSV = (data, filename = 'export.csv') => {
  const csvContent = [
    Object.keys(data[0]).join(','), // Header
    ...data.map(row => Object.values(row).join(','))
  ].join('\n');

  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
};
```

### UI 框架選擇
推薦使用 **Material-UI (MUI)** 或 **Ant Design**:
- Material-UI: 現代設計風格，元件豐富
- Ant Design: 企業級 UI，繁體中文支援完善

### 檔案位置
- **前端程式碼**: `frontend/src/`
- **Dockerfile**: `frontend/Dockerfile`
- **環境變數**: `frontend/.env`

## Dependencies

### 外部依賴
- [ ] Task 003 完成 (FastAPI 後端 API 可用)
- [ ] Node.js >= 16.x
- [ ] npm 或 yarn 套件管理器
- [ ] 前端套件:
  - React >= 18.0
  - React Router >= 6.0
  - Chart.js >= 4.0
  - axios >= 1.3.0
  - Material-UI >= 5.0 或 Ant Design >= 5.0
  - lodash (debounce)

### 內部依賴
- [ ] 後端 API 已部署並可存取
- [ ] Mock API (若後端未完成，可先使用 Mock 資料並行開發)

## Effort Estimate

- **規模**: M (中型)
- **預估時數**: 60 小時 (3 週，每週 20 小時)
  - 專案架構建立: 8 小時
  - Dashboard 頁面: 16 小時
  - Recommendation 頁面: 16 小時
  - ModelManagement 頁面: 12 小時
  - 響應式設計與優化: 8 小時
- **可並行**: true (可在後端開發期間使用 Mock API 並行開發)

## Definition of Done

- [x] 所有頁面實作完成並可正常運作
- [x] API 串接成功，資料正確顯示
- [x] 圖表渲染正確 (Chart.js)
- [x] 響應式設計通過測試 (手機/平板/桌機)
- [x] 頁面載入時間 < 2 秒
- [x] CSV 匯出功能正常
- [x] JWT 認證流程完整
- [x] 錯誤處理與使用者提示完善
- [x] Code Review 完成
- [x] Dockerfile 與環境配置完成
